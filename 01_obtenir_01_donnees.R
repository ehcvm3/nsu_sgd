# ==============================================================================
# mise en place
# ==============================================================================

# ------------------------------------------------------------------------------
# activer l'environnement du projet
# ------------------------------------------------------------------------------

renv::restore(prompt = FALSE)

# ------------------------------------------------------------------------------
# d√©finir les r√©pertoires
# ------------------------------------------------------------------------------

source(here::here("R", "02_definir_repertoires.R"))

# ------------------------------------------------------------------------------
# charger les d√©tails de connexion au serveur
# ------------------------------------------------------------------------------

source(here::here("_details_serveur.R"))
source(here::here("R", "03_valider_details_serveur.R"))

# ==============================================================================
# Donn√©es üíæ
# ==============================================================================

# ------------------------------------------------------------------------------
# Purger les anciens fichiers
# ------------------------------------------------------------------------------

# t√©l√©charg√©es
susoflows::delete_in_dir(dir_donnees_telechargees)
# fusionn√©es
susoflows::delete_in_dir(dir_donnees_fusionnees)

# ------------------------------------------------------------------------------
# T√©l√©charger les donn√©es en archive(s) zip
# ------------------------------------------------------------------------------

susoflows::download_matching(
  matches = nsu_qnr_expr,
  export_type = "STATA",
  path = dir_donnees_telechargees,
  server = serveur,
  workspace = espace_travail,
  user = utilisateur,
  password = mot_de_passe
)

# ------------------------------------------------------------------------------
# D√©comprimer archive(s) zip
# ------------------------------------------------------------------------------

susoflows::unzip_to_dir(dir_donnees_telechargees)
